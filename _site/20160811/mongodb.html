

<!DOCTYPE html>
<!--[if IE 7 ]>    <html lang="zh-CN" class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="zh-CN" class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="zh-CN" class="ie9"> <![endif]-->
<!--[if (gte IE 10)|!(IE)]><!--> <html lang="zh-CN"> <!--<![endif]-->

<head>
  <meta charset="UTF-8">

  <title>mongodb初步学习 - 小一辈无产阶级码农</title>
  <meta name="keywords" content="MongoDB教程,MongoDB学习,MongoDB实战,MongoDB入门">
  
  <meta name="author" content="阳建">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon -->
  <link rel="shortcut icon" href="/favicon.png">

  <!-- Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml">
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml">

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/themes/twitter/css/style.css?ver=20151125">
  <link rel="stylesheet" href="/assets/themes/twitter/css/highlight.css?ver=20151125">
  <link rel="stylesheet" href="/assets/themes/twitter/css/font-awesome.min.css?ver=20151122">
  <!--[if IE 7 ]><link rel="stylesheet" href="/assets/themes/twitter/css/font-awesome-ie7.min.css?ver=20151122"><![endif]-->

  <!-- Scripts -->
  <script type="text/javascript" src="/assets/themes/twitter/js/jquery-1.11.1.min.js"></script>
  <!--[if lt IE 9]><script src="/assets/themes/twitter/js/html5shiv.min.js"></script><![endif]-->
</head>

<body>

  <div id="wrap">
    <header id="top">
      <!-- Home Link -->
      <a id="logo" href="/" title="回到首页">
		  <h1>小一辈无产阶级码农</h1>
      </a>
      <!-- Navigation Bar -->
      <nav id="navbar">
        <ul>
          <li>
            <a href="/" title="首页">Blogs</a>
          </li>
          <li>
            <a href="/categories.html" title="分类">Categories</a>
          </li>
          <li>
            <a href="/tags.html" title="标签">Tags</a>
          </li>
		  <li>
            <a href="/links.html" title="友情链接">Links</a>
          </li>
          <li>
            <a href="/messages.html" title="留言板">Message</a>
          </li>
          <li id="about-link" >
            <a href="/about.html" title="关于我">About</a>
          </li>
          <li id="rss-link">
            <a href="/rss.xml" title="订阅 RSS"><i class="icon-large icon-fixed-width icon-rss"></i></a>
          </li>
        </ul>
      </nav>
    </header>

    <section id="main">

      <!-- Sidebar -->
      <aside id="sidebar">
        <section id="search-box">
          <form id="search-form">
  <input id="query" type="text" placeholder="正则搜索"></input>
  <button type="submit"><i class="icon-search"></i></button>
</form>
<script type="text/javascript">
$(document).ready(function() {
  $('#search-form').submit(function() {
    $('#query').blur().attr('disabled', true);
    $('#main-content').hide();
    $('#loader').show();
    $.ajax({url: '/atom.xml?r=' + (Math.random() * 999999), dataType: 'xml', success: function(data) {
      var rq = new RegExp($('#query').val(), 'im');
      var rl = /\/([^\/]+)\.html$/;
      var html = '';
      $(data).find('entry').each(function(index, entry) {
        var title = $(entry).find('title').text();
        var link = $(entry).find('link').attr('href');
        var title_en = rl.exec(link)[1].replace('-', ' ');
        var content = $(entry).find('content').text();
        if (rq.test(title) || rq.test(title_en) || rq.test(content)) {
          var parts = $(entry).find('updated').text().split(/[-T:+]/g);
          var months = [ "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December" ];
          date = parts[2] + ' ' + months[parts[1] - 1] + ' ' + parts[0];
          html += '<article class="nested">';
          html += '<header><h2><a href="' + link + '">' + title + '</a></h2></header>';
          html += '<section><p>' + content + '</p></section>';
          html += '<footer><p>更新日期：' + date + '</p></footer>';
          html += '</article>';
        }
      });
      $('#main-content').html(html);
      $('#loader').hide();
      $('#main-content').show();
    }});
    $('#query').blur().attr('disabled', false);
    return false;
  });
});
</script>

        </section>
        <section class="active">
          <a href="/" title="查看最近发表"><i class="icon-fixed-width icon-edit"></i> 最近发表</a>
<ul>

  <li class="text-clip"><a href="/20171013/springboot-start.html" title="查看《SpringBoot 的三种启动方式》">SpringBoot 的三种启动方式</a></li>

  <li class="text-clip"><a href="/20170309/xdebug.html" title="查看《phpstrom 实现php断点调试》">phpstrom 实现php断点调试</a></li>

  <li class="text-clip"><a href="/20170301/charles.html" title="查看《charles 抓包工具安装与使用》">charles 抓包工具安装与使用</a></li>

  <li class="text-clip"><a href="/201702/javascript-inherit.html" title="查看《【转】：javascript 实现继承的5种方法》">【转】：javascript 实现继承的5种方法</a></li>

  <li class="text-clip"><a href="/201702/javascript-call-apply.html" title="查看《javascript中call和apply的区别》">javascript中call和apply的区别</a></li>

  <li class="text-clip"><a href="/20170220/react-native.html" title="查看《linux react native开发原生app》">linux react native开发原生app</a></li>

  <li class="text-clip"><a href="/20170219/ubuntu-install-qq2013.html" title="查看《ubuntu 安装Wine longene QQ 7.8 和微信》">ubuntu 安装Wine longene QQ 7.8 和微信</a></li>

  <li class="text-clip"><a href="/2016-11-04/it-team-management.html" title="查看《IT团队管理心得》">IT团队管理心得</a></li>

  <li class="text-clip"><a href="/20161016/imagettftext-notfound.html" title="查看《解决Call to undefined function imagettftext()方法》">解决Call to undefined function imagettftext()方法</a></li>

  <li class="text-clip"><a href="/20161012/check-soft-installed.html" title="查看《Ubuntu上如何检测某个软件包是否安装》">Ubuntu上如何检测某个软件包是否安装</a></li>

</ul>

        </section>
        <section>
          <a href="/archive.html" title="查看所有存档"><i class="icon-fixed-width icon-file-text"></i> 文章存档</a>
<span title="文章总数">30</span>
<ul>


  
  
  
  
    <li><a href="/archive.html#October-2017">2017 年 10 月 (1)</a></li>
    
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#March-2017">2017 年 03 月 (2)</a></li>
    
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#February-2017">2017 年 02 月 (4)</a></li>
    
  

  
  
  
  
    <li><a href="/archive.html#November-2016">2016 年 11 月 (1)</a></li>
    
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#October-2016">2016 年 10 月 (2)</a></li>
    
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#August-2016">2016 年 08 月 (4)</a></li>
    
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#May-2016">2016 年 05 月 (2)</a></li>
    
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#April-2016">2016 年 04 月 (5)</a></li>
    
  

  
  
  
  

  
  
  
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#March-2016">2016 年 03 月 (4)</a></li>
    
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#November-2015">2015 年 11 月 (2)</a></li>
    
  

  
  
  
  

  
  
  
  
    <li><a href="/archive.html#May-2015">2015 年 05 月 (2)</a></li>
    
  

  
  
  
  
    <li><a href="/archive.html#March-2015">2015 年 03 月 (1)</a></li>
    
  

</ul>

        </section>
        <section>
          <a href="/categories.html" title="查看所有分类"><i class="icon-fixed-width icon-folder-open"></i> 文章分类</a>
<span title="分类总数">12</span>
<ul>

  <li><a href="/categories.html#学习和思考-ref">学习和思考 (4)</a></li>

  <li><a href="/categories.html#操作系统-ref">操作系统 (6)</a></li>

  <li><a href="/categories.html#数据库技术-ref">数据库技术 (3)</a></li>

  <li><a href="/categories.html#Funny-ref">Funny (1)</a></li>

  <li><a href="/categories.html#前端开发-ref">前端开发 (3)</a></li>

  <li><a href="/categories.html#服务器运维-ref">服务器运维 (4)</a></li>

  <li><a href="/categories.html#linux-ref">linux (5)</a></li>

  <li><a href="/categories.html#php-ref">php (5)</a></li>

  <li><a href="/categories.html#mongodb-ref">mongodb (1)</a></li>

  <li><a href="/categories.html#nodejs-ref">nodejs (1)</a></li>

  <li><a href="/categories.html#工具-ref">工具 (2)</a></li>

  <li><a href="/categories.html#java编程-ref">java编程 (1)</a></li>

</ul>

        </section>
        <section>
          <a href="/tags.html" title="查看所有标签"><i class="icon-fixed-width icon-tags"></i> 标签云</a>
<span title="标签总数">34</span>
<div id="tag-cloud">






  
    
    
    
    
    
    <a href="/tags.html#linux-ref" style="font-size: 18pt; color: #000;">linux</a>
  
    
    
    
    
    
    <a href="/tags.html#flashpalyer-ref" style="font-size: 9pt; color: #999;">flashpalyer</a>
  
    
    
    
    
    
    <a href="/tags.html#mysql-ref" style="font-size: 10.5pt; color: #777;">mysql</a>
  
    
    
    
    
    
    <a href="/tags.html#ubuntu-ref" style="font-size: 15pt; color: #333;">ubuntu</a>
  
    
    
    
    
    
    <a href="/tags.html#fcitx-ref" style="font-size: 10.5pt; color: #777;">fcitx</a>
  
    
    
    
    
    
    <a href="/tags.html#idea-ref" style="font-size: 10.5pt; color: #777;">idea</a>
  
    
    
    
    
    
    <a href="/tags.html#phpstrom-ref" style="font-size: 12pt; color: #666;">phpstrom</a>
  
    
    
    
    
    
    <a href="/tags.html#jekyll-ref" style="font-size: 10.5pt; color: #777;">jekyll</a>
  
    
    
    
    
    
    <a href="/tags.html#ruby-ref" style="font-size: 9pt; color: #999;">ruby</a>
  
    
    
    
    
    
    <a href="/tags.html#liquid-ref" style="font-size: 9pt; color: #999;">liquid</a>
  
    
    
    
    
    
    <a href="/tags.html#lastPass-ref" style="font-size: 9pt; color: #999;">lastPass</a>
  
    
    
    
    
    
    <a href="/tags.html#javascript-ref" style="font-size: 12pt; color: #666;">javascript</a>
  
    
    
    
    
    
    <a href="/tags.html#跨域-ref" style="font-size: 9pt; color: #999;">跨域</a>
  
    
    
    
    
    
    <a href="/tags.html#运维-ref" style="font-size: 9pt; color: #999;">运维</a>
  
    
    
    
    
    
    <a href="/tags.html#nginx-ref" style="font-size: 9pt; color: #999;">nginx</a>
  
    
    
    
    
    
    <a href="/tags.html#tengine-ref" style="font-size: 9pt; color: #999;">tengine</a>
  
    
    
    
    
    
    <a href="/tags.html#php-ref" style="font-size: 13.5pt; color: #444;">php</a>
  
    
    
    
    
    
    <a href="/tags.html#抓包工具-ref" style="font-size: 10.5pt; color: #777;">抓包工具</a>
  
    
    
    
    
    
    <a href="/tags.html#tcpdump-ref" style="font-size: 9pt; color: #999;">tcpdump</a>
  
    
    
    
    
    
    <a href="/tags.html#docker-ref" style="font-size: 10.5pt; color: #777;">docker</a>
  
    
    
    
    
    
    <a href="/tags.html#dockerfile-ref" style="font-size: 9pt; color: #999;">dockerfile</a>
  
    
    
    
    
    
    <a href="/tags.html#nosql-ref" style="font-size: 9pt; color: #999;">nosql</a>
  
    
    
    
    
    
    <a href="/tags.html#mongodb-ref" style="font-size: 10.5pt; color: #777;">mongodb</a>
  
    
    
    
    
    
    <a href="/tags.html#Ubuntu-ref" style="font-size: 9pt; color: #999;">Ubuntu</a>
  
    
    
    
    
    
    <a href="/tags.html#dpkg-ref" style="font-size: 9pt; color: #999;">dpkg</a>
  
    
    
    
    
    
    <a href="/tags.html#imagettftext-ref" style="font-size: 9pt; color: #999;">imagettftext</a>
  
    
    
    
    
    
    <a href="/tags.html#longeneqq-ref" style="font-size: 9pt; color: #999;">longeneqq</a>
  
    
    
    
    
    
    <a href="/tags.html#react-native-ref" style="font-size: 9pt; color: #999;">react-native</a>
  
    
    
    
    
    
    <a href="/tags.html#react-ref" style="font-size: 9pt; color: #999;">react</a>
  
    
    
    
    
    
    <a href="/tags.html#nodejs-ref" style="font-size: 9pt; color: #999;">nodejs</a>
  
    
    
    
    
    
    <a href="/tags.html#charles-ref" style="font-size: 9pt; color: #999;">charles</a>
  
    
    
    
    
    
    <a href="/tags.html#断点调试-ref" style="font-size: 9pt; color: #999;">断点调试</a>
  
    
    
    
    
    
    <a href="/tags.html#xdebug-ref" style="font-size: 9pt; color: #999;">xdebug</a>
  
    
    
    
    
    
    <a href="/tags.html#spring-boot-ref" style="font-size: 9pt; color: #999;">spring-boot</a>
  

</div>

        </section>
        <div id="fixed-container">
  <section>
    <a href="#"><i class="icon-fixed-width icon-code"></i> 代码仓库</a>
<ul>
  <li><a href="http://git.oschina.net/blackfox/herosphp" target="_blank">Herosphp框架</a></li>
  <li><a href="http://git.oschina.net/blackfox/jekyll-blog" target="_blank">本博客源码</a></li>
  <li><a href="http://git.oschina.net/lionsoul/friso" target="_blank">C语言中文分词</a></li>
  <li><a href="http://git.oschina.net/blackfox/AjaxProxy" target="_blank">Ajax代理插件</a></li>
  <li><a href="https://git.oschina.net/blackfox/purenode" target="_blank">Nodejs web开发框架</a></li>
  <li><a href="http://git.oschina.net/lionsoul/jcseg" target="_blank">Jcseg中文分词工具</a></li>
</ul>

  </section>
  <section>
    <a href="#"><i class="icon-fixed-width icon-heart"></i> 与我联系</a>
<div id="contacts-list">
  <a href="mailto:yangjian102621@gmail.com" target="_blank" title="Gmail">
    <i class="icon-large icon-fixed-width icon-envelope"></i>
  </a>
  <a href="https://github.com/yangjian102621" target="_blank" title="GitHub">
    <i class="icon-large icon-fixed-width icon-github"></i>
  </a>
<!--
  <a href="http://weibo.com/" target="_blank" title="新浪微博">
    <i class="icon-large icon-fixed-width icon-weibo"></i>
  </a>
  <a href="http://v2ex.com/member/" target="_blank" title="V2EX">
    <i class="icon-large icon-fixed-width icon-v2ex"></i>
  </a>
-->
  <a href="https://plus.google.com/116761736844742660869" target="_blank" title="Google+">
    <i class="icon-large icon-fixed-width icon-google-plus"></i>
  </a>
  <a href="https://www.facebook.com/smallstone2017" target="_blank" title="Twitter">
    <i class="icon-large icon-fixed-width icon-facebook"></i>
  </a>
   <a href="https://www.twitter.com/smallstone2017" target="_blank" title="Twitter">
    <i class="icon-large icon-fixed-width icon-twitter"></i>
  </a>
</div>

  </section>
  <section>
    <a href="#"><i class="icon-fixed-width icon-link"></i> 友情链接</a>
<ul>
	<li><a href="http://docs.r9it.com/herosphp/" target="_blank">HerosPHP</a></li>
	<li><a href="https://my.oschina.net/u/940314" target="_blank">开源中国</a></li>
	<li><a href="http://jekyll.com.cn/" target="_blank">Jekyll &bull; 简单的博客</a></li> 
	<li><a href="https://github.com/Shopify/liquid/wiki/Liquid-for-Designers" target="_blank">Liquid 模板引擎</a></li>
	<li><a href="http://liberize.github.io/" target="_blank">本博客模板作者 Liberize</a></li>
 
</ul>

  </section>
</div>
<script type="text/javascript">
$(document).ready(function() {
  var position = $('#fixed-container').offset();
  $(window).scroll(function() {
    if($(window).scrollTop() > position.top) {
      $('#fixed-container').css('position','fixed').css('top','0');
    } else {
      $('#fixed-container').css('position','static');
    }
  });
});
</script>

      </aside>

      <!-- Main Content -->
      <div id="main-inner">
        <div id="loader"><img src="/assets/themes/twitter/img/loading.gif" alt="请稍侯"></div>
        <div id="main-content">
          

<section id="content">
  <article class="post">

    <header>
      <h1>mongodb初步学习</h1>
    </header>

    <section>
      <div class="post-extra">
        <div class="pull-left">
          <span>11 August 2016</span>
        </div>
        <div class="pull-right">
          


  <span id="share">
  <a class="wechat" target="_blank" title="分享到微信" href="http://chart.apis.google.com/chart?cht=qr&amp;chs=300x300&amp;chl=http://www.r9it.com/20160811/mongodb.html"><i class="icon-large icon-wechat"></i></a>
  <a class="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=mongodb初步学习 - 小一辈无产阶级码农&amp;url=http://www.r9it.com/20160811/mongodb.html&amp;type=3&amp;searchPic=1"><i class="icon-large icon-weibo"></i></a>
  <a class="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://www.r9it.com/20160811/mongodb.html&amp;title=mongodb初步学习 - 小一辈无产阶级码农&amp;summary=&amp;site=http://www.r9it.com"><i class="icon-large icon-qzone"></i></a>
  <a class="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=http://www.r9it.com/20160811/mongodb.html&amp;text=mongodb初步学习 - 小一辈无产阶级码农&amp;via=smallstone2017"><i class="icon-large icon-twitter"></i></a>
  <a class="facebook" target="_blank" title="Share to Facebook" href="http://www.facebook.com/sharer.php?u=http://www.r9it.com/20160811/mongodb.html&amp;t=mongodb初步学习 - 小一辈无产阶级码农"><i class="icon-large icon-facebook-sign"></i></a>
  <a class="googleplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=http://www.r9it.com/20160811/mongodb.html"><i class="icon-large icon-google-plus-sign"></i></a>
</span>





        </div>
      </div>
      <div class="post-content"><p>MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。
在高负载的情况下，添加更多的节点，可以保证服务器性能。
MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>

<h1 id="part-6542aa814d1">安装</h1>

<p>mongodb 安装很简单，不管windows还是linux直接去官方下载压缩包解压就行了。本人使用的linux</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-amazon-3.2.8.tgz
tar xvpzf mongodb-linux-x86_64-amazon-3.2.8.tgz
mv mongodb-linux-x86_64-ubuntu1204-3.0.3 /usr/local/mongodb
</code></pre></div>
<h1 id="part-76886bf4d4e7b6a6">添加配置文档</h1>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">vim /usr/local/mongodb/mongodb.conf
</code></pre></div>
<p>添加配置 <code>dbpath=/data/mongodb</code>
创建软连接,并创建目录，<code>{mongo_dir}</code> 表示mongodb的安装目录</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /usr/local/bin
ln -s <span class="o">{</span>mongo_dir<span class="o">}</span>/bin/mongod
ln -s <span class="o">{</span>mongo_dir<span class="o">}</span>/bin/mongo

mkdir -p /data/mongodb
</code></pre></div>
<h1 id="part-654289dfc40">启动</h1>

<p>启动很简单</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">mongod -f /usr/local/mongodb/mongodb.conf
</code></pre></div>
<p>启动成功之后，用<code>mongo</code>客户端连接服务器</p>

<h1 id="part-2d3acd4b9dec9e60">用户管理</h1>

<p>mongodb创建用户老版本和新版不同，新版屏蔽了<code>addUser</code>方法</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">use admin

db.addUser<span class="o">(</span><span class="s2">"root"</span>, <span class="s2">"123456"</span>, <span class="nb">false</span><span class="o">)</span>; <span class="c">#老版本数据库</span>

db.createUser<span class="o">({</span>user: <span class="s2">"root"</span>,pwd: <span class="s2">"123456"</span>,roles: <span class="o">[{</span> role: <span class="s2">"root"</span>, db: <span class="s2">"admin"</span> <span class="o">}]})</span>; <span class="c">#新版数据库</span>

db.system.users.find<span class="o">()</span>.pretty<span class="o">()</span>; <span class="c">#查询用户</span>

db.removeUser<span class="o">(</span><span class="s2">"root"</span><span class="o">)</span>; <span class="c">#删除用户</span>

</code></pre></div>
<p><code>addUser</code>方法的三个参数分别是用户名，密码，第三个参数是表示是否是只读用户，默认是false</p>

<p><code>createUser</code>是新版的创建用户的方法</p>

<blockquote>
<p>user : 用户名 <br>
pwd : 密码 <br>
roles : 指定用户的角色，可以用一个空数组给新用户设定空角色；在roles字段,可以指定内置角色和用户定义的角色</p>
</blockquote>

<p><strong>角色可选值如下</strong></p>

<ul>
<li>Read：允许用户读取指定数据库</li>
<li>readWrite：允许用户读写指定数据库</li>
<li>dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile</li>
<li>userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户</li>
<li>clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</li>
<li>readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限</li>
<li>readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限</li>
<li>userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限</li>
<li>dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</li>
<li>root：只在admin数据库中可用。超级账号，超级权限</li>
</ul>

<h1 id="part-2c6866a4d2515028">插入文档</h1>

<p>mongodb不需要单独创建数据库和数据表(mongo中叫集合)，很方便，由于时nosql，数据的格式也是很灵活，是一个json对象
当执行插入的时候，使用的驱动程序会将数据保存成BSON（关于BSON，这个后续文章会讲到，这里暂且不表）的形式，然后将其送入数据库，数据库解析BSON，会做简单的验证，主要检验是否包含&quot;_id&quot;,并且文档不超过4MB，然后就简单的将文档插入数据库中。不过个人认为这样会带来一些好处或者坏的影响，最明显的副作用就是允许插入无效数据，好处就是这样貌似你也没有办法对mongodb进行注入攻击了，也就是说mongodb对注入攻击时天生免疫的（听起来很牛逼）。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">use user;   <span class="c">#切换数据库，如果不存在则创建</span>

<span class="gp">&gt; </span>show tables;
system.indexes
system.users
system.version
<span class="gp">&gt; </span>db.blog.insert<span class="o">({</span>id:1, title:<span class="s2">"this is a test"</span>, hits:1<span class="o">})</span>; <span class="c">#往blog数据表中插入一个文档，如果blog表不存在则自动创建</span>
WriteResult<span class="o">({</span> <span class="s2">"nInserted"</span> : 1 <span class="o">})</span>
</code></pre></div>
<h1 id="part-2caf4f530fad45d3">更新文档</h1>

<p>MongoDB 使用 update() 和 save() 方法来更新集合中的文档。这里需要特别注明的是：更新的操作时原子性的，若是两个更新同时发生，则先到达服务器的先执行，接着执行另外一个，相互有冲突的更新可以火速传递，并不会产生干扰。</p>

<blockquote>
<p>update(query, data, upsert, multi);</p>
</blockquote>

<p><strong>参数说明：</strong></p>

<ul>
<li>query : update的查询条件，类似sql update查询内where后面的。</li>
<li>data : 要更新的数据</li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li>
<li>multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">db.blog.update<span class="o">({</span>id:1<span class="o">}</span>, <span class="o">{</span>id:2, title:<span class="s2">"new title"</span>, hits:2<span class="o">}</span>, <span class="nb">false</span>, <span class="nb">true</span><span class="o">)</span>; //文档替换
db.blog.update<span class="o">({</span>id:1<span class="o">}</span>, <span class="o">{</span><span class="nv">$set</span> : <span class="o">{</span>id:2, title:<span class="s2">"new title"</span><span class="o">}</span>, <span class="nb">false</span>, <span class="nb">true</span><span class="o">)</span>; //使用修改器修改
</code></pre></div>
<p>有一个问题是：update其实正确的解释是替换文档，并不是真正意义上的更新，因为通常文档只会有一部分需要更新的，
这个时候你就需要用到原子的更新修改器，这可以使得这部分更新极为高效，更新修改器时一种特殊的键，用来制定复杂的更新操作，比如调整，增加或者删除文档的key，还可能是操作数据或者内嵌文档。
mongo 有很多修改器的，下面列举几个</p>

<ul>
<li>$inc 增加某个字段的值  {$inc : {hits:10}} 把点击率加10</li>
<li>$set 修改或者新增部分字段，而不是整个文档替换，这个用的比较经常，毕竟一般我们只改某个文档的部分内容，很少有整个替换的。</li>
<li>$push 修改数组的值</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>db.blog.insert<span class="o">({</span>id:2, title:<span class="s2">"new blog"</span>, tags:[<span class="s2">"fuck"</span>, <span class="s2">"shit"</span><span class="o">]})</span>;
WriteResult<span class="o">({</span> <span class="s2">"nInserted"</span> : 1 <span class="o">})</span>
<span class="gp">&gt; </span>db.blog.find<span class="o">({</span>id:2<span class="o">})</span>;
<span class="o">{</span> <span class="s2">"_id"</span> : ObjectId<span class="o">(</span><span class="s2">"57ac4b860776d82c21a31d77"</span><span class="o">)</span>, <span class="s2">"id"</span> : 2, <span class="s2">"title"</span> : <span class="s2">"new blog"</span>, <span class="s2">"tags"</span> : <span class="o">[</span> <span class="s2">"fuck"</span>, <span class="s2">"shit"</span> <span class="o">]</span> <span class="o">}</span>
<span class="gp">&gt; </span>db.blog.update<span class="o">({</span>id:2<span class="o">}</span>, <span class="o">{</span><span class="nv">$push</span> : <span class="o">{</span>tags:<span class="s2">"oh mygod"</span><span class="o">}})</span>;
WriteResult<span class="o">({</span> <span class="s2">"nMatched"</span> : 1, <span class="s2">"nUpserted"</span> : 0, <span class="s2">"nModified"</span> : 1 <span class="o">})</span>
<span class="gp">&gt; </span>db.blog.find<span class="o">({</span>id:2<span class="o">})</span>;
<span class="o">{</span> <span class="s2">"_id"</span> : ObjectId<span class="o">(</span><span class="s2">"57ac4b860776d82c21a31d77"</span><span class="o">)</span>, <span class="s2">"id"</span> : 2, <span class="s2">"title"</span> : <span class="s2">"new blog"</span>, <span class="s2">"tags"</span> : <span class="o">[</span> <span class="s2">"fuck"</span>, <span class="s2">"shit"</span>, <span class="s2">"oh mygod"</span> <span class="o">]</span> <span class="o">}</span>
</code></pre></div>
<h1 id="part-2cc29d85ae38f355">查询文档</h1>

<p>mongo的查询功能很强大，几乎可以跟sql数据库相媲美，尤其是还提供了很多操作符查询的
&quot;$gt&quot; 、&quot;$gte&quot;、 &quot;$lt&quot;、 &quot;$lte&quot;、&quot;null查询&quot;、&quot;$all&quot;、&quot;$size&quot;、&quot;$in&quot;、&quot;$nin&quot;、
&quot;$and&quot;、&quot;$nor&quot;、&quot;$not&quot;、&quot;$or&quot;、&quot;$exists&quot;、&quot;$mod&quot;、&quot;$regex&quot;、&quot;$where&quot;、&quot;$slice&quot;、&quot;$elemMatch&quot;...</p>

<p>下面举几个例子</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">db.blog.find<span class="o">()</span>;  <span class="c">#查找所有文档</span>
db.blog.find<span class="o">({</span>id:1<span class="o">})</span>; <span class="c">#查找id=1的文档</span>
db.user.find<span class="o">({</span>name:/jack/i<span class="o">})</span>; <span class="c">#正则查询，相当于sql中like查询</span>
db.user.find<span class="o">({</span>age:<span class="o">{</span><span class="nv">$gte</span>: 16, <span class="nv">$lt</span>:18<span class="o">}})</span>; <span class="c">#where age &gt; 16 AND age &lt; 18</span>
db.user.find<span class="o">({</span><span class="nv">$or</span>:<span class="o">{</span>name:<span class="s2">"xiaoming"</span>, sex:<span class="s2">"M"</span><span class="o">}})</span>; <span class="c">#where name=xiaoyang OR sex=M</span>
db.user.find<span class="o">({</span>name : <span class="o">{</span><span class="nv">$in</span>:[<span class="s2">"xiaoming"</span>,<span class="s2">"xiaoyang"</span>, <span class="s2">"xiaowang"</span><span class="o">]}})</span>; <span class="c">#where name IN('xiaoming', 'xiaoyang', 'xiaowang')</span>
db.user.find<span class="o">({</span>name:<span class="s2">"xiaoyang"</span><span class="o">})</span>.skip<span class="o">(</span>10<span class="o">)</span>.limit<span class="o">(</span>20<span class="o">)</span>.sort<span class="o">({</span>id:-1<span class="o">})</span>; <span class="c">#分页查询，并且order by id desc</span>
...
</code></pre></div>
<h1 id="part-2b9114f82e8516a5">删除文档</h1>

<blockquote>
<p>db.remove(query, justOne);</p>
</blockquote>

<p><strong>参数说明：</strong></p>

<ul>
<li>query : update的查询条件，类似sql update查询内where后面的。</li>
<li>justOne : 默认为true，之删除匹配到的第一文档，如果设置为true，则会删除匹配到的所有文档</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">db.blog.remove<span class="o">({</span>id:1<span class="o">})</span>;
db.user.remove<span class="o">({</span>status:0<span class="o">}</span>, <span class="nb">false</span><span class="o">)</span>; <span class="c">#删除所有未审核的用户</span>
</code></pre></div>
<p>删除文档速度时很快的，几乎在一瞬间完成的，但是如果你要清空整个文档，并且文档的数据量又大，建议你直接删除集合（然后重建索引）会更快。比如一个含有100w个文档的集合，你一条一条删除可能要花费近50秒的时间，但是直接删除集合却只要0.01秒不到。</p>

<h1 id="mongodb">MongoDB优缺点分析</h1>

<p><strong> 通过这两天的简单学习，发现mongodb的优势还是很明显的</strong></p>

<ol>
<li>速度比较快，我使用php的Mongodb扩展进行测试，插入100w条记录平均耗时65秒，每秒钟插入15000条左右，这速度甩mysql几条街</li>
<li>文档的格式相当自由，这对于关系行数据库优势还是比较大的，对于一些不规则的数据结构比如商品的属性什么的，每个中商品的属性都不一样，各类的都有，这要是用关系型数据库去实现得建N个表，折腾半天才能勉强实现，但是如果用<code>mongo</code>的话，一个表就可以解决，而且逻辑非常建档，相当方便。</li>
<li>相对于<code>mysql</code>的读写分离主从配置，分表分库什么的，<code>mongo</code>的分片还是简单的多，所以说<code>mongo</code>的扩展性和高可用也是有保障的。</li>
<li>内置了<code>GridFS</code> GridFS是一个出色的分布式文件系统，可以支持海量的数据存储，能够满足对大数据集的快速范围查询。</li>
<li>内置了强大的查询功能，支持各种复杂查询，尤其时$where操作符查询，使得查询几乎能做任何事情了，可以跟sql数据库达到相同的效果，甚至能实现更复杂的查询。</li>
</ol>

<p><strong>当然，缺点也是有的</strong></p>

<ol>
<li>对于已经习惯了写sql来查询的小伙伴来说mongo的查询条件确实有点复杂，没有sql那么简单直接，尤其一些分组查询之类的，虽然能实现，但是确实是比较麻烦的。</li>
<li>不支持事务，这个确实是个蛋疼的问题，这就注定了一些业务的数据肯定是不能用mongo来存储了，如果非要的话可能时要自己在应用层实现事务了。不过这也不是太大的问题，大不了把那些数据存回mysql之类的关系型数据库了。</li>
<li>mongodb占用的空间比较大，其实mongo的效率是用空间换来的，首先BSON这种文档格式就不是很省空间，而且mongo的一些操作也是有点浪费空间，比如mongo在删除数据的时候其实并没有真正的释放磁盘空间，为避免记录删除后的数据的大规模挪动，原记录空间不删除，只标记“已删除”即可，以后还可以重复利用。</li>
<li>目前我还没有发现，以后再慢慢找。。。</li>
</ol>
</div>
      
    </section>

  </article>
</section>

<section>

  <div class="tag-box-wrapper">
    
    <ul class="tag-box inline">
      <li><i class="icon-large icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#数据库技术-ref">
    		数据库技术 <span>3</span>
    	</a></li>
    
  



    </ul>
    

    
    <ul class="tag-box inline">
      <li><i class="icon-large icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#nosql-ref">nosql <span>1</span></a></li>
     
    	<li><a href="/tags.html#mongodb-ref">mongodb <span>2</span></a></li>
     
    	<li><a href="/tags.html#mysql-ref">mysql <span>2</span></a></li>
    
  



    </ul>
    
  </div>

  <div class="pagination">
    <ul>
      
      <li class="prev"><a href="/20160502/docker-study-2.html" title="docker学习笔记（二）">&larr; 上一篇</a></li>
      
      <li><a href="/archive.html">文章列表</a></li>
      
      <li class="next"><a href="/20160814/php-true.html" title="php的true和TRUE引发的一些思考">下一篇 &rarr;</a></li>
      
    </ul>
  </div>

</section>

<script src="/assets/themes/twitter/js/highlight.js"></script>
<script type="text/javascript">
	//初始化代码高亮
	hljs.initHighlightingOnLoad();
</script>



<script src="/assets/themes/twitter/js/jpreview.js"></script>
<script src="/assets/themes/twitter/js/JLazyLoader.js"></script>
<script type="text/javascript">
	//初始化图片预览插件, 图片延时加载
	$(".img-view").jpreview();
</script>



<section id="comments">
  


  
<div class="post-comments" style="overflow:hidden;">

	<!--畅言评论高速版-->
	<div id="SOHUCS" sid="/20160811/mongodb"></div>
	<script charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/changyan.js" ></script>
	<script type="text/javascript">
	$(document).ready(function() {
	   window.changyan.api.config({
			appid: 'cysmNxmia',
			conf: 'prod_a49688836dc6cfb80dfc53f48bb864ab'
	   });
		
	});
    
	</script>        
</div>







</section>


        </div>
      </div>

      <div id="back-top">
  <a href="#top" title="回到顶部">
    <i class="icon-2x icon-arrow-up"></i>
  </a>
</div>
<script type="text/javascript">
$("#back-top").hide();
$(document).ready(function () {
  $(window).scroll(function () {
    if ($(this).scrollTop() > 100) {
      $('#back-top').fadeIn();
    } else {
      $('#back-top').fadeOut();
    }
  });
  $('#back-top a').click(function () {
    $('body,html').animate({
      scrollTop: 0
    }, 500);
    return false;
  });
});
</script>


    </section>

    <footer id="bottom">
      <p align="center">&copy; 2017 阳建
        with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
        and <a href="https://github.com/yangjian102621/yangjian102621.github.com" target="_blank">source on GitHub</a>
      </p>
    </footer>
  </div>

  <script type="text/javascript">
    $('article.post a').attr('target', '_blank');
    if (navigator.appVersion.indexOf("Mac") != -1) {
      $('code, pre').css('font-family', 'Courier, monospace');
    }
  </script>
  


  <script type="text/javascript">
//百度统计代码
if ( location.host.indexOf('r9it.com') !== -1 ) {
	var _hmt = _hmt || [];
	(function() {
	 var hm = document.createElement("script");
	 hm.src = "//hm.baidu.com/hm.js?fa1700c08f6ac35179270783fc63a18f";
	 var s = document.getElementsByTagName("script")[0]; 
	 s.parentNode.insertBefore(hm, s);
	 })();

}
</script>





  
</body>
</html>

