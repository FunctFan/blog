<h1 id="section">安装依赖</h1>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>apt-get install -y build-essential gcc g++ make

<span class="k">for </span>packages <span class="k">in </span>bzip2 libzip-dev libperl-dev libc6-dev  
libevent-dev libpcre3 libpcre3-dev libpcrecpp0 zlibc openssl 
libsasl2-dev libmcrypt-dev libbz2-1.0 libbz2-dev libpng3 
libjpeg62 libjpeg62-dev libpng-dev libpng12-0 libpng12-dev curl 
libcurl3 libmhash2 libmhash-dev libpq-dev libpq5 gettext 
libncurses5-dev libjpeg-dev libxml2-dev libfreetype6 
libfreetype6-dev libssl-dev libcurl3 libcurl4-openssl-dev 
libcurl4-gnutls-dev mcrypt;
<span class="k">do 
</span>apt-get install -y <span class="nv">$packages</span> --force-yes;
apt-get -fy install;
apt-get -y autoremove; 
<span class="k">done</span>

</code></pre>
</div>

<h1 id="php">下载php</h1>
<p>去 http://php.net/downloads.php下载你想要安装的版本，我下载的是5.5.26</p>

<p>tar xvpzf php-5.5.26.tar.gz</p>

<h1 id="php-1">配置php编译选项</h1>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>php-5.5.26
./configure --prefix<span class="o">=</span>/usr/local/php <span class="se">\</span>
	 --with-config-file-path<span class="o">=</span>/usr/local/php/etc <span class="se">\</span>
	 --with-config-file-scan-dir<span class="o">=</span>/usr/local/php/etc/conf.d <span class="se">\</span>
	 --enable-fpm <span class="se">\</span>
	 --with-mhash <span class="se">\</span>
	 --with-fpm-user<span class="o">=</span>www-data <span class="se">\</span>
	 --with-fpm-group<span class="o">=</span>www-data <span class="se">\</span>
	 --with-mysql<span class="o">=</span>mysqlnd <span class="se">\</span>
	 --enable-maintainer-zts <span class="se">\</span>
	 --with-mysqli<span class="o">=</span>mysqlnd <span class="se">\</span>
	 --with-pdo-mysql<span class="o">=</span>mysqlnd <span class="se">\</span>
	 --enable-opcache <span class="se">\</span>
	 --enable-inline-optimization <span class="se">\</span>
	 --enable-sockets <span class="se">\</span>
	 --enable-zip <span class="se">\</span>
	 --with-jpeg-dir <span class="se">\</span>
	 --with-png-dir <span class="se">\</span>
	 --enable-calendar <span class="se">\</span>
	 --with-zlib <span class="se">\</span>
	 --with-bz2 <span class="se">\</span>
	 --with-iconv <span class="se">\</span>
	 --with-gd <span class="se">\</span>
	 --with-libXML-dir<span class="o">=</span>/usr/local/phpdep/libxml2 <span class="se">\</span>
	 --enable-gd-native-ttf <span class="se">\</span>
	 --enable-mbstring <span class="se">\</span>
	 --with-curl <span class="se">\</span>
	 --enable-ftp <span class="se">\</span>
	 --with-mcrypt <span class="se">\</span>
	 --enable-bcmath <span class="se">\</span>
	 --disable-debug <span class="se">\</span>
	 --with-openssl <span class="se">\</span>
	 --disable-fileinfo <span class="se">\</span>
	 --enable-sysvsem --enable-inline-optimization

</code></pre>
</div>

<h1 id="section-1">安装</h1>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>
make <span class="nv">ZEND_EXTRA_LIBS</span><span class="o">=</span><span class="s1">'-liconv'</span>
make
make install

</code></pre>
</div>

<h1 id="section-2">修改配置文档</h1>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd</span> /usr/local/php/etc 
mkdir conf.d
cp php-fpm.con.default php-fpm.conf 
cp  php.ini-development php.ini

</code></pre>
</div>

<h1 id="section-3">编写启动脚本</h1>

<p>vim /usr/local/bin/php-fpm</p>

<p>copy 下面代码</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>
<span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c"># this script starts and stops the php-fpm daemon</span>
<span class="c"># author yangjian</span>
<span class="c"># processname: php-fpm</span>
<span class="c"># config:      /usr/local/php/etc/php-fpm.conf</span>


<span class="nv">DESC</span><span class="o">=</span><span class="s2">"php-fpm daemon"</span>
<span class="nv">PHP_DIR</span><span class="o">=</span>/usr/local/php
<span class="nv">NAME</span><span class="o">=</span>php-fpm
<span class="nv">DAEMON</span><span class="o">=</span><span class="nv">$PHP_DIR</span>/sbin/<span class="nv">$NAME</span>
<span class="nv">PHP_CONFIG_FILE</span><span class="o">=</span><span class="nv">$PHP_DIR</span>/etc/php.ini
<span class="nv">FPM_CONFIG_FILE</span><span class="o">=</span><span class="nv">$PHP_DIR</span>/etc/php-fpm.conf 
<span class="nv">PIDFILE</span><span class="o">=</span><span class="nv">$PHP_DIR</span>/var/run/<span class="nv">$NAME</span>.pid

<span class="c"># If the daemon file is not found, terminate the script.</span>
<span class="nb">test</span> -x <span class="nv">$DAEMON</span> <span class="o">||</span> <span class="nb">exit </span>0

d_start<span class="o">(){</span>
	<span class="nv">$DAEMON</span> -y <span class="nv">$FPM_CONFIG_FILE</span> -c <span class="nv">$PHP_CONFIG_FILE</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">" Faild to start service. </span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>

d_stop<span class="o">(){</span>
	<span class="nb">kill</span> -QUIT <span class="sb">`</span>cat <span class="nv">$PIDFILE</span><span class="sb">`</span>  <span class="o">||</span> <span class="nb">echo</span> -n <span class="s2">" no running. </span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>

d_reload<span class="o">(){</span>
	<span class="nb">kill</span> -USR2 <span class="sb">`</span>cat <span class="nv">$PIDFILE</span><span class="sb">`</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">" could not reload. </span><span class="se">\n</span><span class="s2">"</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
</span>start<span class="p">)</span>
<span class="nb">echo</span> <span class="s2">"Starting </span><span class="nv">$DESC</span><span class="s2">: </span><span class="nv">$NAME</span><span class="s2"> OK!</span><span class="se">\n</span><span class="s2">"</span>
d_start
<span class="p">;;</span>

stop<span class="p">)</span>
<span class="nb">echo</span> <span class="s2">"Stopping </span><span class="nv">$DESC</span><span class="s2">: </span><span class="nv">$NAME</span><span class="s2"> OK!</span><span class="se">\n</span><span class="s2">"</span>
d_stop
<span class="p">;;</span>

reload<span class="p">)</span>
<span class="nb">echo</span> <span class="s2">"Reloading </span><span class="nv">$DESC</span><span class="s2"> configuration... </span><span class="se">\n</span><span class="s2">"</span>
d_reload
<span class="nb">echo</span> <span class="s2">"Reloaded."</span>
<span class="p">;;</span>

restart<span class="p">)</span>
<span class="nb">echo</span> -n <span class="s2">"Restarting </span><span class="nv">$DESC</span><span class="s2">: </span><span class="nv">$NAME</span><span class="s2"> Successfully. </span><span class="se">\n</span><span class="s2">"</span>
d_stop
sleep 1
d_start
<span class="p">;;</span>

<span class="k">*</span><span class="p">)</span>
<span class="nb">echo</span> <span class="s2">"Usage:{start|stop|restart|reload)"</span> &gt;&amp;2
<span class="nb">exit </span>3
<span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0

</code></pre>
</div>

<p>启动php-fpm</p>

<blockquote>
  <p>chmod +x /usr/local/bin/php-fpm <br />
/usr/local/bin/php-fpm start</p>
</blockquote>

