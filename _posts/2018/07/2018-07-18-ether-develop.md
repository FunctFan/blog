---
layout: post
title: 以太坊开发入门指南
categories: [以太坊,区块链]
tags: [区块链, 以太坊]
status: publish
type: post
published: true
author: blackfox
permalink: /20180718/ether-develop.html
keyword: 
desc: 
---

以太坊是什么
====
以太坊（Ethereum）是一个建立在区块链技术之上， 去中心化应用平台。它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。

> 如果不理解你可以把以太坊想象成天猫商城, 大家可以在它上面建立各种店铺(DApp)。

在没有以太坊之前，写区块链应用是这样的：拷贝一份比特币代码，然后去改底层代码如加密算法，共识机制，网络协议等等（很多山寨币就是这样，改改就出来一个新币）。
以太坊平台对底层区块链技术进行了封装，让区块链应用开发者可以直接基于以太坊平台进行开发，开发者只要专注于应用本身的开发，从而大大降低了难度。

什么是智能合约
======
简单来说，智能合约就是写在以太坊上面的程序，如果要再抽象化一下那就是: 智能合约是写在区块链上的程序，之所以叫智能合约，因为它不可篡改，没有人可以干预
它的执行. 总结如下:

> 智能合约可以理解为在区块链上可以自动执行的（由事件驱动的）、以代码形式编写的合同（特殊的交易）。

智能合约非常适合对信任、安全和持久性要求较高的应用场景，比如：数字货币、数字资产、投票、保险、金融应用、预测市场、产权所有权管理、物联网、点对点交易等等。

以太坊的智能合约是图灵完备的，意味着你可以使用它来完成任何的业务逻辑的编写。
__如无特殊说明, 后面我们说的智能合约都是指以太坊的智能合约。__


编程语言：Solidity
=====
智能合约的默认的编程语言是Solidity，文件扩展名以.sol结尾。
Solidity是和JavaScript相似的语言，用它来开发合约并编译成以太坊虚拟机字节代码。

通常我们使用 Remix IDE 来编写智能合约，它以太坊官方出的一个浏览器 IDE，使用非常方便。
这是地址: [http://remix.ethereum.org/](http://remix.ethereum.org/)

__不过它通常都有点慢，尤其是那些没有翻墙的同学__, 所以建议你把它下载到本地来，它是一个静态网页，解压就可以用。当然，前提是你本地有安装 web 服务器。
如果没有安装的话，推荐 [nginx](https://nginx.org/cn/), 非常好用的 web 服务器，地球人都知道的。

Remix 下载地址：[https://github.com/ethereum/remix/releases](https://github.com/ethereum/remix/releases)

运行环境：EVM
=====
学过 Java 的同学估计看到 EVM 第一时间就会想到 JVM 这个东西，没错，就是你想的那样，顾名思义，EVM（Ethereum Virtual Machine）
以太坊虚拟机是以太坊中智能合约的运行环境。EVM运行在以太坊节点上，当我们把合约部署到以太坊网络上之后，合约就可以在以太坊网络中运行了。

合约的编译和部署
=======

以太坊虚拟机上运行的是合约的字节码形式，需要我们在部署之前先对合约进行编译。通常我们可以选择 Remix IDE 或者客户端钱包进行编译和部署, 推荐使用 Remix, 
毕竟客户端钱包太重了，同步去快得好几天，而且需要消耗掉你 > 100 GB (以后会越来越大) 的存储空间.

> 下图是 Remix 的编译和运行界面截图：

<img class="img-view" data-src="/images/2018/07/remix-ide.png" src="/images/1px.png" />

<img class="img-view" data-src="/images/2018/07/remix-ide-2.png" src="/images/1px.png" />


以太坊中的账户
======

和比特币使用UTXO的设计不一样，以太坊使用更为简单的账户概念。以太坊中的账户分为两种: 外部账户和合约账户

> 外部账户: 该类账户被私钥控制（由人控制），没有关联任何代码。 <br />
合约账户: 该类账户被它们的合约代码控制且有代码与之关联。

外部账户与合约账户的区别和关系是这样的：一个外部账户可以通过创建和用自己的私钥来对交易进行签名，来发送消息给另一个外部账户或合约账户。
在两个外部账户之间传送消息是价值转移的过程。但从外部账户到合约账户的消息会激活合约账户的代码，
允许它执行各种动作（比如转移代币，写入内部存储，挖出一个新代币，执行一些运算，创建一个新的合约等等）。
只有当外部账户发出指令时，合同账户才会执行相应的操作。

合约部署就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上（由实际矿工出块之后，才真正部署成功）。

运行合约
======
合约部署之后，当需要调用这个智能合约的方法时只需要向这个合约账户发送消息（交易）即可，通过消息触发后智能合约的代码就会在EVM中执行了。


Gas 值
====

Gas 是以太坊虚拟机的独创，任何转账，交易发送，合约发布，合约执行，合约调用都需要消耗 Gas, 
一般来说智能合约越复杂（计算步骤的数量和类型，占用的内存等），用来完成运行就需要越多Gas。
任何特定的合约所需的运行合约的Gas数量是固定的，由合约的复杂度决定。
而Gas价格由运行合约的人在提交运行合约请求的时候规定，以确定他愿意为这次交易愿意付出的费用：Gas价格（用以太币计价） * Gas数量。

Gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行交易时，Gas将按照特定规则被逐渐消耗，无论执行到什么位置，一旦Gas被耗尽，将会触发异常。
当前调用帧所做的所有状态修改都将被回滚， 如果执行结束还有Gas剩余，这些Gas将被返还给发送账户。

> 如果没有这个限制，就会有人写出无法停止（如：死循环）的合约来阻塞网络。

在实际开发的时候，我们需要一个有以太币余额的外部账户，来发起一个交易（普通交易或部署、运行一个合约），运行时，矿工收取相应的工作量费用。

以太坊智能合约的开发环境
=======

> 我们可以通过以下方式模拟以太坊的开发环境，这样即使没有以太币也能进行智能合约开发

1. 选择以太坊官网测试网络Testnet, 测试网络中，我们可以很容易获得免费的以太币，缺点是需要发很长时间初始化节点。
2. 使用 geth 启动一个私有链， 如果不了解 geth 请点击[这里](http://www.r9it.com/20180503/geth.html)
3. 使用模拟环境 Ganache 或者 Ganache-cli， Ganache GUI 客户端可以到这里下载 [https://truffleframework.com/ganache](https://truffleframework.com/ganache)
Ganache-cli 安装起来更加方便，直接 npm install -g ganache-cli 就可以了. 

#### 启动 Ganache

```bash
#如果你下载的是客户端的可执行文件，直接执行就好了, 如
/opt/ganache-1.1.0-x86_64.AppImage 
# 如果是 ganache-cli 更简单
ganache-cli
```

Dapp：去中心化的应用程序
====
以太坊社区把基于智能合约的应用称为去中心化的应用程序(Decentralized App)。如果我们把区块链理解为一个不可篡改的数据库，智能合约理解为和数据库打交道的程序，
那就很容易理解Dapp了，一个Dapp不单单有智能合约，比如还需要有一个友好的用户界面和其他的东西。

Truffle 
======
Truffle是Dapp开发框架，它可以帮我们处理掉大量无关紧要的小事情，让我们可以迅速开始写代码-编译-部署-测试-打包DApp这个流程。

安装很简单

```bash
npm install -g truffle
```

值得一提的是，Truffle 和 Ganache 是同一个组织的，点击这里[快速开始](https://truffleframework.com/docs) 

总结 
====

以上就是本人根据自己的经验总结的有关以太坊开发的相关知识，仅供参考。有兴趣的同学不要观望了，赶紧上车。









